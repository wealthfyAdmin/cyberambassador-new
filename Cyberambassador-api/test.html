<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  // âŒ DO NOT force websocket in Codespaces
  // âœ… Let Socket.IO auto-upgrade (polling â†’ websocket)
  const socket = io("https://improved-zebra-jjpvqr744wvq2qrr6-3000.app.github.dev", {
    transports: ["websocket"],
  });

  socket.on("connect", () => {
    console.log("âœ… Connected:", socket.id);

    // ğŸ”‘ REQUIRED: register so socket joins the room
    socket.emit("register", {
      userId: "test-user-1"
    });
  });

  socket.on("disconnect", (reason) => {
    console.log("âŒ Disconnected:", reason);
  });

  // ğŸ”¥ THIS IS THE IMPORTANT PART
  socket.on("message", (payload) => {
    // ALWAYS log raw payload first
    console.log("ğŸ“¦ RAW SOCKET PAYLOAD:", payload);

    if (!payload || !payload.type) {
      console.warn("âš ï¸ Invalid payload received");
      return;
    }

    if (payload.type === "NEW_MESSAGE") {
      console.log("ğŸ†• New message:", payload.message?.content);
    }

    if (payload.type === "EDIT_MESSAGE") {
      console.log("âœï¸ Edited message:", payload.message?.content);
    }

    if (payload.type === "DELETE_MESSAGE") {
      console.log("ğŸ—‘ï¸ Deleted message ID:", payload.messageId);
    }
  });

  socket.on("system", (data) => {
    console.log("â„¹ï¸ System event:", data);
  });

  socket.on("connect_error", (err) => {
    console.error("âŒ Socket connect error:", err.message);
  });
</script>
